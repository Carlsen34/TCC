{"dependencies":[{"name":"../core","data":{"isAsync":false}},{"name":"./to-buffer","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var util = _$$_REQUIRE(_dependencyMap[0], \"../core\").util;\n\n  var toBuffer = _$$_REQUIRE(_dependencyMap[1], \"./to-buffer\").toBuffer;\n\n  var PRELUDE_MEMBER_LENGTH = 4;\n  var PRELUDE_LENGTH = PRELUDE_MEMBER_LENGTH * 2;\n  var CHECKSUM_LENGTH = 4;\n  var MINIMUM_MESSAGE_LENGTH = PRELUDE_LENGTH + CHECKSUM_LENGTH * 2;\n\n  function splitMessage(message) {\n    if (!util.Buffer.isBuffer(message)) message = toBuffer(message);\n\n    if (message.length < MINIMUM_MESSAGE_LENGTH) {\n      throw new Error('Provided message too short to accommodate event stream message overhead');\n    }\n\n    if (message.length !== message.readUInt32BE(0)) {\n      throw new Error('Reported message length does not match received message length');\n    }\n\n    var expectedPreludeChecksum = message.readUInt32BE(PRELUDE_LENGTH);\n\n    if (expectedPreludeChecksum !== util.crypto.crc32(message.slice(0, PRELUDE_LENGTH))) {\n      throw new Error('The prelude checksum specified in the message (' + expectedPreludeChecksum + ') does not match the calculated CRC32 checksum.');\n    }\n\n    var expectedMessageChecksum = message.readUInt32BE(message.length - CHECKSUM_LENGTH);\n\n    if (expectedMessageChecksum !== util.crypto.crc32(message.slice(0, message.length - CHECKSUM_LENGTH))) {\n      throw new Error('The message checksum did not match the expected value of ' + expectedMessageChecksum);\n    }\n\n    var headersStart = PRELUDE_LENGTH + CHECKSUM_LENGTH;\n    var headersEnd = headersStart + message.readUInt32BE(PRELUDE_MEMBER_LENGTH);\n    return {\n      headers: message.slice(headersStart, headersEnd),\n      body: message.slice(headersEnd, message.length - CHECKSUM_LENGTH)\n    };\n  }\n\n  module.exports = {\n    splitMessage: splitMessage\n  };\n});","map":[[2,0,1,0],[2,6,1,4,"util"],[2,10,1,8],[2,13,1,11,"require"],[2,24,1,18],[2,54,1,11],[2,55,1,30,"util"],[2,59,1,0],[4,0,2,0],[4,6,2,4,"toBuffer"],[4,14,2,12],[4,17,2,15,"require"],[4,28,2,22],[4,62,2,15],[4,63,2,38,"toBuffer"],[4,71,2,0],[6,0,5,0],[6,6,5,4,"PRELUDE_MEMBER_LENGTH"],[6,27,5,25],[6,30,5,28],[6,31,5,0],[7,0,7,0],[7,6,7,4,"PRELUDE_LENGTH"],[7,20,7,18],[7,23,7,21,"PRELUDE_MEMBER_LENGTH"],[7,44,7,42],[7,47,7,45],[7,48,7,0],[8,0,9,0],[8,6,9,4,"CHECKSUM_LENGTH"],[8,21,9,19],[8,24,9,22],[8,25,9,0],[9,0,11,0],[9,6,11,4,"MINIMUM_MESSAGE_LENGTH"],[9,28,11,26],[9,31,11,29,"PRELUDE_LENGTH"],[9,45,11,43],[9,48,11,46,"CHECKSUM_LENGTH"],[9,63,11,61],[9,66,11,64],[9,67,11,0],[11,0,18,0],[11,11,18,9,"splitMessage"],[11,23,18,0],[11,24,18,22,"message"],[11,31,18,0],[11,33,18,31],[12,0,19,4],[12,8,19,8],[12,9,19,9,"util"],[12,13,19,13],[12,14,19,14,"Buffer"],[12,20,19,9],[12,21,19,21,"isBuffer"],[12,29,19,9],[12,30,19,30,"message"],[12,37,19,9],[12,38,19,4],[12,40,19,40,"message"],[12,47,19,47],[12,50,19,50,"toBuffer"],[12,58,19,58],[12,59,19,59,"message"],[12,66,19,58],[12,67,19,40],[14,0,21,4],[14,8,21,8,"message"],[14,15,21,15],[14,16,21,16,"length"],[14,22,21,8],[14,25,21,25,"MINIMUM_MESSAGE_LENGTH"],[14,47,21,4],[14,49,21,49],[15,0,22,8],[15,12,22,14],[15,16,22,18,"Error"],[15,21,22,14],[15,22,22,24],[15,95,22,14],[15,96,22,8],[16,0,23,5],[18,0,25,4],[18,8,25,8,"message"],[18,15,25,15],[18,16,25,16,"length"],[18,22,25,8],[18,27,25,27,"message"],[18,34,25,34],[18,35,25,35,"readUInt32BE"],[18,47,25,27],[18,48,25,48],[18,49,25,27],[18,50,25,4],[18,52,25,52],[19,0,26,8],[19,12,26,14],[19,16,26,18,"Error"],[19,21,26,14],[19,22,26,24],[19,86,26,14],[19,87,26,8],[20,0,27,5],[22,0,29,4],[22,8,29,8,"expectedPreludeChecksum"],[22,31,29,31],[22,34,29,34,"message"],[22,41,29,41],[22,42,29,42,"readUInt32BE"],[22,54,29,34],[22,55,29,55,"PRELUDE_LENGTH"],[22,69,29,34],[22,70,29,4],[24,0,31,4],[24,8,32,8,"expectedPreludeChecksum"],[24,31,32,31],[24,36,32,36,"util"],[24,40,32,40],[24,41,32,41,"crypto"],[24,47,32,36],[24,48,32,48,"crc32"],[24,53,32,36],[24,54,33,12,"message"],[24,61,33,19],[24,62,33,20,"slice"],[24,67,33,12],[24,68,33,26],[24,69,33,12],[24,71,33,29,"PRELUDE_LENGTH"],[24,85,33,12],[24,86,32,36],[24,87,31,4],[24,89,35,6],[25,0,36,8],[25,12,36,14],[25,16,36,18,"Error"],[25,21,36,14],[25,22,37,12],[25,74,38,12,"expectedPreludeChecksum"],[25,97,37,12],[25,100,39,12],[25,149,36,14],[25,150,36,8],[26,0,41,5],[28,0,43,4],[28,8,43,8,"expectedMessageChecksum"],[28,31,43,31],[28,34,43,34,"message"],[28,41,43,41],[28,42,43,42,"readUInt32BE"],[28,54,43,34],[28,55,43,55,"message"],[28,62,43,62],[28,63,43,63,"length"],[28,69,43,55],[28,72,43,72,"CHECKSUM_LENGTH"],[28,87,43,34],[28,88,43,4],[30,0,45,4],[30,8,46,8,"expectedMessageChecksum"],[30,31,46,31],[30,36,46,36,"util"],[30,40,46,40],[30,41,46,41,"crypto"],[30,47,46,36],[30,48,46,48,"crc32"],[30,53,46,36],[30,54,47,12,"message"],[30,61,47,19],[30,62,47,20,"slice"],[30,67,47,12],[30,68,47,26],[30,69,47,12],[30,71,47,29,"message"],[30,78,47,36],[30,79,47,37,"length"],[30,85,47,29],[30,88,47,46,"CHECKSUM_LENGTH"],[30,103,47,12],[30,104,46,36],[30,105,45,4],[30,107,49,6],[31,0,50,8],[31,12,50,14],[31,16,50,18,"Error"],[31,21,50,14],[31,22,51,12],[31,84,52,16,"expectedMessageChecksum"],[31,107,50,14],[31,108,50,8],[32,0,54,5],[34,0,56,4],[34,8,56,8,"headersStart"],[34,20,56,20],[34,23,56,23,"PRELUDE_LENGTH"],[34,37,56,37],[34,40,56,40,"CHECKSUM_LENGTH"],[34,55,56,4],[35,0,57,4],[35,8,57,8,"headersEnd"],[35,18,57,18],[35,21,57,21,"headersStart"],[35,33,57,33],[35,36,57,36,"message"],[35,43,57,43],[35,44,57,44,"readUInt32BE"],[35,56,57,36],[35,57,57,57,"PRELUDE_MEMBER_LENGTH"],[35,78,57,36],[35,79,57,4],[36,0,59,4],[36,11,59,11],[37,0,60,8,"headers"],[37,6,60,8,"headers"],[37,13,60,15],[37,15,60,17,"message"],[37,22,60,24],[37,23,60,25,"slice"],[37,28,60,17],[37,29,60,31,"headersStart"],[37,41,60,17],[37,43,60,45,"headersEnd"],[37,53,60,17],[37,54,59,11],[38,0,61,8,"body"],[38,6,61,8,"body"],[38,10,61,12],[38,12,61,14,"message"],[38,19,61,21],[38,20,61,22,"slice"],[38,25,61,14],[38,26,61,28,"headersEnd"],[38,36,61,14],[38,38,61,40,"message"],[38,45,61,47],[38,46,61,48,"length"],[38,52,61,40],[38,55,61,57,"CHECKSUM_LENGTH"],[38,70,61,14],[39,0,59,11],[39,5,59,4],[40,0,63,1],[42,0,68,0,"module"],[42,2,68,0,"module"],[42,8,68,6],[42,9,68,7,"exports"],[42,16,68,0],[42,19,68,17],[43,0,69,4,"splitMessage"],[43,4,69,4,"splitMessage"],[43,16,69,16],[43,18,69,18,"splitMessage"],[44,0,68,17],[44,3,68,0]]},"type":"js/module"}]}