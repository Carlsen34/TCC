{"dependencies":[{"name":"./parse-message","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var parseMessage = _$$_REQUIRE(_dependencyMap[0], \"./parse-message\").parseMessage;\n\n  function parseEvent(parser, message, shape) {\n    var parsedMessage = parseMessage(message);\n    var messageType = parsedMessage.headers[':message-type'];\n\n    if (messageType) {\n      if (messageType.value === 'error') {\n        throw parseError(parsedMessage);\n      } else if (messageType.value !== 'event') {\n        return;\n      }\n    }\n\n    var eventType = parsedMessage.headers[':event-type'];\n    var eventModel = shape.members[eventType.value];\n\n    if (!eventModel) {\n      return;\n    }\n\n    var result = {};\n    var eventPayloadMemberName = eventModel.eventPayloadMemberName;\n\n    if (eventPayloadMemberName) {\n      var payloadShape = eventModel.members[eventPayloadMemberName];\n\n      if (payloadShape.type === 'binary') {\n        result[eventPayloadMemberName] = parsedMessage.body;\n      } else {\n        result[eventPayloadMemberName] = parser.parse(parsedMessage.body.toString(), payloadShape);\n      }\n    }\n\n    var eventHeaderNames = eventModel.eventHeaderMemberNames;\n\n    for (var i = 0; i < eventHeaderNames.length; i++) {\n      var name = eventHeaderNames[i];\n\n      if (parsedMessage.headers[name]) {\n        result[name] = eventModel.members[name].toType(parsedMessage.headers[name].value);\n      }\n    }\n\n    var output = {};\n    output[eventType.value] = result;\n    return output;\n  }\n\n  function parseError(message) {\n    var errorCode = message.headers[':error-code'];\n    var errorMessage = message.headers[':error-message'];\n    var error = new Error(errorMessage.value || errorMessage);\n    error.code = error.name = errorCode.value || errorCode;\n    return error;\n  }\n\n  module.exports = {\n    parseEvent: parseEvent\n  };\n});","map":[[2,0,1,0],[2,6,1,4,"parseMessage"],[2,18,1,16],[2,21,1,19,"require"],[2,32,1,26],[2,70,1,19],[2,71,1,46,"parseMessage"],[2,83,1,0],[4,0,10,0],[4,11,10,9,"parseEvent"],[4,21,10,0],[4,22,10,20,"parser"],[4,28,10,0],[4,30,10,28,"message"],[4,37,10,0],[4,39,10,37,"shape"],[4,44,10,0],[4,46,10,44],[5,0,11,4],[5,8,11,8,"parsedMessage"],[5,21,11,21],[5,24,11,24,"parseMessage"],[5,36,11,36],[5,37,11,37,"message"],[5,44,11,36],[5,45,11,4],[6,0,14,4],[6,8,14,8,"messageType"],[6,19,14,19],[6,22,14,22,"parsedMessage"],[6,35,14,35],[6,36,14,36,"headers"],[6,43,14,22],[6,44,14,44],[6,59,14,22],[6,60,14,4],[8,0,15,4],[8,8,15,8,"messageType"],[8,19,15,4],[8,21,15,21],[9,0,16,8],[9,10,16,12,"messageType"],[9,21,16,23],[9,22,16,24,"value"],[9,27,16,12],[9,32,16,34],[9,39,16,8],[9,41,16,43],[10,0,17,12],[10,14,17,18,"parseError"],[10,24,17,28],[10,25,17,29,"parsedMessage"],[10,38,17,28],[10,39,17,12],[11,0,18,9],[11,7,16,8],[11,13,18,15],[11,17,18,19,"messageType"],[11,28,18,30],[11,29,18,31,"value"],[11,34,18,19],[11,39,18,41],[11,46,18,15],[11,48,18,50],[12,0,20,12],[13,0,21,9],[14,0,22,5],[16,0,25,4],[16,8,25,8,"eventType"],[16,17,25,17],[16,20,25,20,"parsedMessage"],[16,33,25,33],[16,34,25,34,"headers"],[16,41,25,20],[16,42,25,42],[16,55,25,20],[16,56,25,4],[17,0,27,4],[17,8,27,8,"eventModel"],[17,18,27,18],[17,21,27,21,"shape"],[17,26,27,26],[17,27,27,27,"members"],[17,34,27,21],[17,35,27,35,"eventType"],[17,44,27,44],[17,45,27,45,"value"],[17,50,27,21],[17,51,27,4],[19,0,28,4],[19,8,28,8],[19,9,28,9,"eventModel"],[19,19,28,4],[19,21,28,21],[20,0,29,8],[21,0,30,5],[23,0,32,4],[23,8,32,8,"result"],[23,14,32,14],[23,17,32,17],[23,19,32,4],[24,0,34,4],[24,8,34,8,"eventPayloadMemberName"],[24,30,34,30],[24,33,34,33,"eventModel"],[24,43,34,43],[24,44,34,44,"eventPayloadMemberName"],[24,66,34,4],[26,0,35,4],[26,8,35,8,"eventPayloadMemberName"],[26,30,35,4],[26,32,35,32],[27,0,36,8],[27,10,36,12,"payloadShape"],[27,22,36,24],[27,25,36,27,"eventModel"],[27,35,36,37],[27,36,36,38,"members"],[27,43,36,27],[27,44,36,46,"eventPayloadMemberName"],[27,66,36,27],[27,67,36,8],[29,0,38,8],[29,10,38,12,"payloadShape"],[29,22,38,24],[29,23,38,25,"type"],[29,27,38,12],[29,32,38,34],[29,40,38,8],[29,42,38,44],[30,0,39,12,"result"],[30,8,39,12,"result"],[30,14,39,18],[30,15,39,19,"eventPayloadMemberName"],[30,37,39,18],[30,38,39,12],[30,41,39,45,"parsedMessage"],[30,54,39,58],[30,55,39,59,"body"],[30,59,39,12],[31,0,40,9],[31,7,38,8],[31,13,40,15],[32,0,41,12,"result"],[32,8,41,12,"result"],[32,14,41,18],[32,15,41,19,"eventPayloadMemberName"],[32,37,41,18],[32,38,41,12],[32,41,41,45,"parser"],[32,47,41,51],[32,48,41,52,"parse"],[32,53,41,45],[32,54,41,58,"parsedMessage"],[32,67,41,71],[32,68,41,72,"body"],[32,72,41,58],[32,73,41,77,"toString"],[32,81,41,58],[32,83,41,45],[32,85,41,89,"payloadShape"],[32,97,41,45],[32,98,41,12],[33,0,42,9],[34,0,43,5],[36,0,46,4],[36,8,46,8,"eventHeaderNames"],[36,24,46,24],[36,27,46,27,"eventModel"],[36,37,46,37],[36,38,46,38,"eventHeaderMemberNames"],[36,60,46,4],[38,0,47,4],[38,9,47,9],[38,13,47,13,"i"],[38,14,47,14],[38,17,47,17],[38,18,47,4],[38,20,47,20,"i"],[38,21,47,21],[38,24,47,24,"eventHeaderNames"],[38,40,47,40],[38,41,47,41,"length"],[38,47,47,4],[38,49,47,49,"i"],[38,50,47,50],[38,52,47,4],[38,54,47,54],[39,0,48,8],[39,10,48,12,"name"],[39,14,48,16],[39,17,48,19,"eventHeaderNames"],[39,33,48,35],[39,34,48,36,"i"],[39,35,48,35],[39,36,48,8],[41,0,49,8],[41,10,49,12,"parsedMessage"],[41,23,49,25],[41,24,49,26,"headers"],[41,31,49,12],[41,32,49,34,"name"],[41,36,49,12],[41,37,49,8],[41,39,49,41],[42,0,51,12,"result"],[42,8,51,12,"result"],[42,14,51,18],[42,15,51,19,"name"],[42,19,51,18],[42,20,51,12],[42,23,51,27,"eventModel"],[42,33,51,37],[42,34,51,38,"members"],[42,41,51,27],[42,42,51,46,"name"],[42,46,51,27],[42,48,51,52,"toType"],[42,54,51,27],[42,55,51,59,"parsedMessage"],[42,68,51,72],[42,69,51,73,"headers"],[42,76,51,59],[42,77,51,81,"name"],[42,81,51,59],[42,83,51,87,"value"],[42,88,51,27],[42,89,51,12],[43,0,52,9],[44,0,53,5],[46,0,55,4],[46,8,55,8,"output"],[46,14,55,14],[46,17,55,17],[46,19,55,4],[47,0,56,4,"output"],[47,4,56,4,"output"],[47,10,56,10],[47,11,56,11,"eventType"],[47,20,56,20],[47,21,56,21,"value"],[47,26,56,10],[47,27,56,4],[47,30,56,30,"result"],[47,36,56,4],[48,0,57,4],[48,11,57,11,"output"],[48,17,57,4],[49,0,58,1],[51,0,60,0],[51,11,60,9,"parseError"],[51,21,60,0],[51,22,60,20,"message"],[51,29,60,0],[51,31,60,29],[52,0,61,4],[52,8,61,8,"errorCode"],[52,17,61,17],[52,20,61,20,"message"],[52,27,61,27],[52,28,61,28,"headers"],[52,35,61,20],[52,36,61,36],[52,49,61,20],[52,50,61,4],[53,0,62,4],[53,8,62,8,"errorMessage"],[53,20,62,20],[53,23,62,23,"message"],[53,30,62,30],[53,31,62,31,"headers"],[53,38,62,23],[53,39,62,39],[53,55,62,23],[53,56,62,4],[54,0,63,4],[54,8,63,8,"error"],[54,13,63,13],[54,16,63,16],[54,20,63,20,"Error"],[54,25,63,16],[54,26,63,26,"errorMessage"],[54,38,63,38],[54,39,63,39,"value"],[54,44,63,26],[54,48,63,48,"errorMessage"],[54,60,63,16],[54,61,63,4],[55,0,64,4,"error"],[55,4,64,4,"error"],[55,9,64,9],[55,10,64,10,"code"],[55,14,64,4],[55,17,64,17,"error"],[55,22,64,22],[55,23,64,23,"name"],[55,27,64,17],[55,30,64,30,"errorCode"],[55,39,64,39],[55,40,64,40,"value"],[55,45,64,30],[55,49,64,49,"errorCode"],[55,58,64,4],[56,0,65,4],[56,11,65,11,"error"],[56,16,65,4],[57,0,66,1],[59,0,71,0,"module"],[59,2,71,0,"module"],[59,8,71,6],[59,9,71,7,"exports"],[59,16,71,0],[59,19,71,17],[60,0,72,4,"parseEvent"],[60,4,72,4,"parseEvent"],[60,14,72,14],[60,16,72,16,"parseEvent"],[61,0,71,17],[61,3,71,0]]},"type":"js/module"}]}